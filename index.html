<html>
<head>
  <script src="https://openlayers.org/en/v4.0.1/build/ol.js" type="text/javascript"></script>
  <style>
  #map {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 100%;
  }
  </style>
  <script>
  var zoom = 9;
  styleFunction = function(feature) {
    var features = feature.get('features');
    var style;
    var total;
    for (var i = 0, total = 0; i < features.length; i++) {
      total += features[i].get('AANT_INW');
    }
    var radius = Math.pow(2, zoom - 9) * Math.sqrt(total) / 32;
    if (radius < 1) {
      radius = 1;
    }
    style = new ol.style.Style({
      image: new ol.style.Circle({
        radius: radius,
        stroke: new ol.style.Stroke({
          color: '#fff'
        }),
        fill: new ol.style.Fill({
          color: 'green'
        })
      }),
      text: new ol.style.Text({
        text: total.toString(),
        fill: new ol.style.Fill({
          color: '#fff'
        })
      })
    });
    return [style];
  };

  var vectorSource = new ol.source.Vector({
        url: 'buurt_punten_2016.geojson',
        format: new ol.format.GeoJSON()
      });

  var vectorLayer = new ol.layer.Vector({
        source: new ol.source.Cluster({
          source: vectorSource,
          distance: 40
        }),
        style: styleFunction
      });
  function init() {
    var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM({url: 'https://phenology.geodan.nl/mapproxy/osm/tiles/osmgrayscale_EPSG900913/{z}/{x}/{y}.png?origin=nw'})
          }),
          vectorLayer
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat([5, 52]),
          zoom: zoom
        })
      });
    map.getView().on('change:resolution', function(){ zoom = map.getView().getZoom()});
  }
  </script>
</head>
<body onload="init()">
  <div id="map"></div>
</body>
</html>
